---
id: 002
title: constitution-update-to-web-app
stage: constitution
date: 2026-01-03
surface: agent
model: claude-sonnet-4.5-20250929
feature: none
branch: 001-todo-console
user: N/A
command: /sp.constitution
labels: ["constitution", "web-app", "major-version-bump"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
 - .specify/memory/constitution.md
tests:
 - none
---

## Prompt

# üìú Project Constitution
## Hackathon Todo ‚Äî CLI In-Memory App to Full-Stack Web Application

---

## 1. Purpose

This constitution defines the mandatory rules, principles, scope, and constraints for transforming an existing **CLI in-memory Todo application** into a **modern, authenticated, multi-user web application**.

All development must follow a **spec-driven, agentic workflow** using **Claude Code + Spec-Kit Plus**.
No manual coding is permitted.

---

## 2. Core Objective

Transform the CLI Todo app into a **persistent full-stack application** that:

- Supports multiple authenticated users
- Stores data persistently in a cloud database
- Exposes a secure REST API
- Provides a responsive frontend interface
- Enforces strict user-level data isolation

---

## 3. Development Rules (Non-Negotiable)

1. **Spec-Driven Development Only**
   - No code may be written without an approved specification.
   - Workflow must always follow:
     ```
     Spec ‚Üí Plan ‚Üí Tasks ‚Üí Implementation ‚Üí Review
     ```

2. **No Manual Coding**
   - All code must be generated by **Claude Code**.
   - The developer may only:
     - Write specifications
     - Review generated output
     - Request revisions

3. **Monorepo Requirement**
   - Frontend and backend must live in a single repository.
   - Claude Code must operate with full-project context.

4. **Security First**
   - All API endpoints must be authenticated.
   - Users must never access another user's data.

---

## 4. Functional Scope

### 4.1 Basic Level Features (Required)

The web application must implement all core features from the CLI app:

1. Create a task
2. List all tasks
3. View task details
4. Update a task
5. Delete a task
6. Toggle task completion status

All operations must be scoped to the authenticated user.

---

## 5. Technology Stack (Fixed)

| Layer | Technology |
|------|-----------|
| Frontend | Next.js 16+ (App Router) |
| Backend | Python FastAPI |
| ORM | SQLModel |
| Database | Neon Serverless PostgreSQL |
| Authentication | Better Auth |
| Spec-Driven Dev | Claude Code + Spec-Kit Plus |
| Containerization | Docker + Docker Compose |

No substitutions are allowed.

---

## 6. REST API Contract

The following API endpoints must be implemented:

| Method | Endpoint | Description |
|------|---------|-------------|
| GET | `/api/{user_id}/tasks` | List all tasks |
| POST | `/api/{user_id}/tasks` | Create a new task |
| GET | `/api/{user_id}/tasks/{id}` | Get task details |
| PUT | `/api/{user_id}/tasks/{id}` | Update a task |
| DELETE | `/api/{user_id}/tasks/{id}` | Delete a task |
| PATCH | `/api/{user_id}/tasks/{id}/complete` | Toggle completion |

---

## 7. Authentication Constitution

### 7.1 Authentication Model

- Authentication is handled on the frontend using **Better Auth**
- Authorization on the backend is enforced using **JWT verification**

### 7.2 JWT Rules

1. Better Auth must issue JWT tokens on user login
2. Frontend must attach the token to every API request:

3. Backend must:
- Verify token signature
- Decode user identity
- Enforce ownership on every operation

### 7.3 Shared Secret

- Both frontend and backend must use the same secret:

- Secrets must be provided via environment variables only
- No hardcoded secrets are allowed

---

## 8. Backend Rules (FastAPI)

- Use **SQLModel** exclusively for database access
- All queries must be filtered by authenticated user ID
- Middleware must:
- Extract JWT from headers
- Reject invalid or expired tokens
- Backend must remain stateless

---

## 9. Frontend Rules (Next.js)

- Use the **App Router**
- Implement a responsive UI
- Use Better Auth for:
- Signup
- Signin
- Session management
- Attach JWT token to every API request
- Never trust client-side user identifiers

---

## 10. Database Rules (Neon PostgreSQL)

- Database must be cloud-hosted only
- No local PostgreSQL containers
- Schema must include:
- Users
- Tasks
- Task ownership relationship
- Persistent storage fully replaces in-memory storage

---

## 11. Docker Constitution

- Docker must be used for:
- Frontend (Next.js)
- Backend (FastAPI)
- Docker Compose must:
- Start the system with one command
- Connect services to Neon PostgreSQL
- The database must not run inside Docker

---

## 12. Repository Structure (Mandatory)


Claude Code must preserve and respect this structure.

---

## 13. Success Criteria

The project is complete when:

- All basic features work end-to-end
- Authentication is enforced on every request
- Users can only access their own tasks
- Application runs using `docker-compose up`
- No manual code edits were made
- Specifications clearly map to implementation

---

## 14. Authority

This constitution overrides all informal decisions, shortcuts, or personal preferences.

All contributors ‚Äî human or AI ‚Äî must comply fully.

## Response snapshot

Successfully updated constitution from v1.0.0 to v2.0.0 (MAJOR bump). Transformed the project governance from a CLI in-memory application to a full-stack web application with authentication, persistence, and multi-user support. All placeholder tokens replaced with concrete values based on user input. Templates verified for consistency - no updates required. Created comprehensive sync impact report documenting the architectural transformation.

## Outcome

- ‚úÖ Impact: Complete architectural transformation from CLI to web application
- üß™ Tests: none
- üìÅ Files: .specify/memory/constitution.md
- üîÅ Next prompts: None suggested - constitution ready for feature specification phase
- üß† Reflection: This is a MAJOR version bump (v1.0.0 ‚Üí v2.0.0) due to complete transformation of the technology stack, architecture, and scope. All templates are aligned and no manual follow-up is needed.

## Evaluation notes (flywheel)

- Failure modes observed: none
- Graders run and results (PASS/FAIL): N/A
- Prompt variant (if applicable): N/A
- Next experiment (smallest change to try): N/A
